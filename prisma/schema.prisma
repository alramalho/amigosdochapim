generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum SubscriptionTier {
  APOIANTE
  AMIGO
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  PAST_DUE
  INCOMPLETE
}

model User {
  id                   String             @id @default(cuid())
  email                String             @unique
  name                 String?
  supabaseId           String?            @unique @map("supabase_id")
  stripeCustomerId     String?            @unique @map("stripe_customer_id")
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")

  subscription         Subscription?
  donations            Donation[]

  @@map("users")
}

model Subscription {
  id                   String             @id @default(cuid())
  userId               String             @unique @map("user_id")
  stripeSubscriptionId String             @unique @map("stripe_subscription_id")
  tier                 SubscriptionTier
  status               SubscriptionStatus @default(ACTIVE)
  currentPeriodStart   DateTime           @map("current_period_start")
  currentPeriodEnd     DateTime           @map("current_period_end")
  cancelAtPeriodEnd    Boolean            @default(false) @map("cancel_at_period_end")
  createdAt            DateTime           @default(now()) @map("created_at")
  updatedAt            DateTime           @updatedAt @map("updated_at")

  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Donation {
  id                   String             @id @default(cuid())
  userId               String             @map("user_id")
  amount               Int                // Amount in cents (1500=Apoiante, 2500=Amigo, 5000=Mecenas)
  stripePaymentIntentId String?           @unique @map("stripe_payment_intent_id")
  createdAt            DateTime           @default(now()) @map("created_at")

  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("donations")
}
